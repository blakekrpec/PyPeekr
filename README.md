# pypi_monitor
Python package to use a raspberry + display as a computer stat monitoring screen. 

The project is designed to have a server that hosts the computer stats over a local network. A client then grabs this data and presents it in a GUI on. 

Clone the project
```
git clone git@github.com:blakekrpec/pypi_monitor.git
```
### Server

#### Windows Server
[LibreHardwareMonitor](https://github.com/blakekrpec/LibreHardwareMonitor) project as the server on Windows to host the pc information over the web. 

To install LibreHardwareMonitor, grab the latest release. Then extract, and run the app. 

Launch LibreHardwareMonitor and make the following changes to settings:

    Options > Enable Run on Windows Startup
    Options > Minimize on Close
    Options > Remote Web Server > Enable Run 
    Options > Remote Web Server > Port > (set desired port and note it)


#### Linux Server

The Linux server is written in python. It currently outputs temperature and utilization data for Intel CPUs, AMD CPUs, and Nvidia GPUs. AMD GPUs are to be added at a later late when one is available for testing.

The linux server can be started with `run_linux_server` from inside the activated python virtual environment, .pypi_monitor. 

### Client
The client is written in python and sends http GET requests to the server. When the main GUI is started, the appropriate client (windows or linux) is started automatically. The Windows and Linux clients are almost identical except that they handle data formats from their respective server, and reformat them into a format that is common between both clients. 

### Running pypi_monitor

#### Linux Setup
run setup script
```
./linux_setup.sh
```
Source the python virtual environment
```
source .pypi_monitor/bin/activate
```
Start the Linux server 
```
run_linux_server
```
In a separate terminal source venv and start the client GUI
```
source .pypi_monitor/bin/activate
gui
```
In the GUI you will need to enter the IP of the server. If running server and gui on the same machine, localhost port 8000 should work (127.0.0.1:8000).

#### Windows Setup

run setup script
```
.\windows_setup.bat
```
source venv
```
.\pypi_monitor\Scripts\activate
```
run code 
```
gui
```
In the GUI you will need to enter the IP of the server. This will be the IP and port used in the LibreHardwareMonitor settings.


Current design:

- All python files in pypi_monitor should abide by Flake8 formatting guidelines. The linter should be run before all commits are made. Run the linter with `lint_pypi` from within the sourced .pypi_monitor virtual environment. Tools like pylint should also be used to check for bad practices (the pylint extension in VSCode is very useful), but it is not required commits satisfy all concerns generated by pylint (or similar tools). It is required that all commits return no concerns when running `lint_pypi`.  

- The intended client is a RasPi on your LAN with a systemctl service to run the gui on startup. However, the client should be able to run on any Windows, or Linux machine. 

- Server
    - On Linux, the server is custom.
    - On Windows, the LibreHardwareMonitor REST API will be used. Data from LibreHardwareMonitor is parsed by the client and stored in a structure identical to what the Linux server creates so that the GUI is agnostic of where the data is coming from. 

- Done: 
    - Files separated for readability 
    - Settings functionality done (save and reset)
    - Settings button added to open settings dialog
    - Settings dialog has file and view tabs 
    - View tab added pick color ability 
    - View tab added displays button for displays dialog
    - Displays dialog done, has cpu and gpu tab
    - CPU and GPU tabs fleshed out, and now update the global settings in memory when interacted with.  
    - Added "gui" command with poetry to run the gui easily.
    - Added a check to make sure pip is up to date. 
    - Made "dark mode the default".
    - Moved to Qt6.
    - Create the pane manager class. Laid out the PaneController class. 
    - Display enable buttons text now toggle between enable and disable depending on button state. 
    - Add a resize event to the display pages so that actual stat buttons are half size.
    - Cleaned up Styling to new default. 
    - Pane Controller is implemented. 
    - Started laying out client scripts. 
    - Added ip as a setting, and allow the user to change it. 
    - Moved settings files out of the git repo to hide user ip addr from git. 
    - Made the above move of settings work on windows. 
    - Added port option to the settings so user can change it. 
    - Save IP Address button now writes IP settings to settings.yaml.
    - Added the stats (min, max, avg) to the panes.
    - Added a warning prompt when resetting that requires user to confirm before resetting. 
    - Added a slider for the user to change update rate in seconds. 
    - Fixed bug where eventResize was creating panes behind the settings button. 
        - Issue was resizeEvent was called on startup (which calls update_settings), and causing a race condition with the MainWindow__ init __  call of update_settings(). To fix added a delay where resizeEvent is ignored until the GUI has been up for 0.5 seconds. Should probably find a better way to do this. 
    - Fixed bug where on startup saw: "QLayout: Attempting to add QLayout "" to FileSettingsPage "", which already has a layout". Fixed because "self.slider_layout = QHBoxLayout(self)" needed to be "self.slider_layout = QHBoxLayout()" since self here is the FileSettingsPage QWidget, which is not what we were trying to apply self.slider_layout to. 
    - Python files now formatted to Flake8 formatting guidelines, and will continue to do so from now on. 
    - Added pause button to stop and start client threads. Also removed is_running from settings. Seemed unnecessary as the client should always start up on init, negating the need to save a false value for is_running. 
    - Added command to run the linter.
    - Added linux server, and poetry command to run it.
    - Linux server now also hosts, min, max, and avg values. The Windows client data dumper should structure things in a similar fashion so that the GUI can expect a common stat/data structure. 
    - Moved the logic to maintain min, max, and avg stats into the client, to separate from server. This will likely be more similar to how Windows data will need to be read, organized, and stored. 
    - Added a reset button. 
    - Linux client is now working and listening to linux server. 
    - Linux client is now displaying values in the gui.
    - Fixed pause not working (thread wasn't being killed properly.)
    - Limited stats to 1 decimal place, and added labels (min/max/avg).
    - PaneController now reads in data from main_window.data, instead of fake numbers. 
    - Fixed tick marks not showing.
    - Added setting for main font color.
    - Changing font color now changes font across entire app.  
    - Fixed bug where IP checker wasn't checking all 4 parts of the address. 
    - Fixed bug where IP checked crashed if given a char instead of an int. 
    - Fixed issue where gui wasn't running on Windows after all the big changes. 
    - Windows client now works and grabs data to display. 
    - Added support for AMD CPUs in the Linux server.
    - Fixed bug where windows client didn't return gpu core temp, it returned avg of all gpu temps. 
    - Added setting so user can choose to handle list data as either max, or avg. Only tested in Linux.
    - Tested that user choosing between max and average also works on Windows. 
    - Going to need to switch to LibreHardwareMonitor. The only endpoint currently in LibreHardwareMonitor is data.json and it is a mess to parse.
        - Switching because: OpenHardwareMonitor CPU loads are wrong. Compared against LibreHardwareMonitor, Task Manager, and Riva Stat Server. All were same except OHM.
        - Either need to modify LibreHardwareMonitor. Or, figure how to parse data. I'd rather not parse data cause it is huge, and may be slow on a rapi. 
    - Modified LibreHardwareMonitor to return for endpoints. Its modified on my personal fork. 
    - test_sensor.py shows how to access the new LibreHardwareMonitorEndpoints.
    - Added a libre_hwm_inspector cmd line tool to print the http request from Libre Hardware Monitor. This allows users to introspect it. 
    - Modified client to work with LibreHwMonitor data. Decided not to use min and max values from Libre so that they could be reset in pypi gui without sending requests to Libre to reset. 
    - Just going to get one temp and load from Libre, so remove max, avg options from clients, and settings.

- Next: 
    - Add a release to my fork of LibreHardwareMonitor. 
    - Open a PR for LibreHardwareMonitor to merge in the fix for adding individual endpoints.
    - Add toggle for CPU and GPU for user to select brand. 
        - Add support for AMD GPUs to Linux server. Use pyamdgpuinfo module. 
    - Change name util/utilzn/utilization to load throughout the project.
    - Add a logger to log errors and progress. Then add a button in settings where the user can print/view the log.
    - Get PyQt6 to run on RasPi.
    - Can we send a request to Libre to reset min and max values? Then we wouldn't have to track them within pypi, we could just use the values in the requests. Maybe use wireshark to look at the request that gets sent when resetting in the browser page of LibreHwMonitor. 

- Bugs:
