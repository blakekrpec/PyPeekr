# pypi_monitor
Tools to use a raspberry + display as a computer stat monitoring screen. 

The project is designed to have a server that hosts the computer stats over a local network. A client then grabs this data and presents it in a GUI on. 

Clone the project
```
git clone git@github.com:blakekrpec/pypi_monitor.git
```

### Server
[OpenHardwareMonitor](https://github.com/hexagon-oss/openhardwaremonitor) project as the server on Windows to host the pc information over the web. Future work aims to implement a Linux server as well, although this will likely be a custom implementation that mimics the data structure hosted by OpenHardwareMonitor.

To install OpenHardwareMonitor, grab the latest release [here](https://github.com/hexagon-oss/openhardwaremonitor/releases). Then follow the setup guide to complete installation. The http endpoints available are "/api/available" (returns "true" or an error if not), "/api/version" (returns the version of the server), "/api/rootnode" (returns a json with the sensor tree and all the values), "/api/nodes/{NodeId}" (returns a json with just the information for the given node).

Launch OpenHardwareMonitor and make the following changes to settings:

    Enable run on startup
    Enable web server
    Enable remote access for the web server

### Client 
The client will be written in python and will listen for data from server, and send it to the gui to be displayed. 

### GUI
The gui is written in python with Qt. It spawns a client to listen to data from server, and displays it in the gui.

The gui, and client live in the pypi_monitor pip package. The linux_setup.sh script included will create a python virtual environment for you, and install pypi_monitor in it.

#### Linux Setup
run setup script
```
./linux_setup.sh
```
Source the python virtual environment
```
source .pypi_monitor/bin/activate
```
Start the Linux server 
```
run_linux_server
```
In a separate terminal source venv and start the client GUI
```
source .pypi_monitor/bin/activate
gui
```
In the GUI you will need to enter the IP of the server. If running server on your machine, localhost port 8000 should work (127.0.0.1:8000).

#### Windows Setup (Windows GUI not complete yet, it just has dummy numbers)

run setup script
```
.\windows_setup.bat
```
source venv
```
.\pypi_monitor\Scripts\activate
```
run code 
```
gui
```

Current design:

- All python files in pypi_monitor should abide by Flake8 formatting guidelines. The linter should be run before all commits are made. Run the linter with `lint_pypi` from within the sourced .pypi_monitor vent. Tools like pylint should also be used to check for bad practices (the pylint extension in VSCode is very useful), but it is not required commits satisfy all concerns generated by pylint (or similar tools). It is required that all commits return no concerns when running `lint_pypi`.  

- Client will be a RasPi on the LAN with a systemctl service to run the gui on startup.

- Server
    - On Linux, the server is custom.
    - On Windows, the OpenHardwareMonitor REST API will be used. Data from OpenHardwareMonitor is stored in a structure identical to what the Linux server creates so that the GUI is agnostic of where the data is coming from. 

- Done: 
    - Files separated for readability 
    - Settings functionality done (save and reset)
    - Settings button added to open settings dialog
    - Settings dialog has file and view tabs 
    - View tab added pick color ability 
    - View tab added displays button for displays dialog
    - Displays dialog done, has cpu and gpu tab
    - CPU and GPU tabs fleshed out, and now update the global settings in memory when interacted with.  
    - Added "gui" command with poetry to run the gui easily.
    - Added a check to make sure pip is up to date. 
    - Made "dark mode the default".
    - Moved to Qt6.
    - Create the pane manager class. Laid out the PaneController class. 
    - Display enable buttons text now toggle between enable and disable depending on button state. 
    - Add a resize event to the display pages so that actual stat buttons are half size.
    - Cleaned up Styling to new default. 
    - Pane Controller is implemented. 
    - Started laying out client scripts. 
    - Added ip as a setting, and allow the user to change it. 
    - Moved settings files out of the git repo to hide user ip addr from git. 
    - Made the above move of settings work on windows. 
    - Added port option to the settings so user can change it. 
    - Save IP Address button now writes IP settings to settings.yaml.
    - Added the stats (min, max, avg) to the panes.
    - Added a warning prompt when resetting that requires user to confirm before resetting. 
    - Added a slider for the user to change update rate in seconds. 
    - Fixed bug where eventResize was creating panes behind the settings button. 
        - Issue was resizeEvent was called on startup (which calls update_settings), and causing a race condition with the MainWindow__ init __  call of update_settings(). To fix added a delay where resizeEvent is ignored until the GUI has been up for 0.5 seconds. Should probably find a better way to do this. 
    - Fixed bug where on startup saw: "QLayout: Attempting to add QLayout "" to FileSettingsPage "", which already has a layout". Fixed because "self.slider_layout = QHBoxLayout(self)" needed to be "self.slider_layout = QHBoxLayout()" since self here is the FileSettingsPage QWidget, which is not what we were trying to apply self.slider_layout to. 
    - Python files now formatted to Flake8 formatting guidelines, and will continue to do so from now on. 
    - Added pause button to stop and start client threads. Also removed is_running from settings. Seemed unnecessary as the client should always start up on init, negating the need to save a false value for is_running. 
    - Added command to run the linter.
    - Added linux server, and poetry command to run it.
    - Linux server now also hosts, min, max, and avg values. The Windows client data dumper should structure things in a similar fashion so that the GUI can expect a common stat/data structure. 
    - Moved the logic to maintain min, max, and avg stats into the client, to separate from server. This will likely be more similar to how Windows data will need to be read, organized, and stored. 
    - Added a reset button. 
    - Linux client is now working and listening to linux server. 
    - Linux client is now displaying values in the gui.
    - Fixed pause not working (thread wasn't being killed properly.)
    - Limited stats to 1 decimal place, and added labels (min/max/avg).
    - PaneController now reads in data from main_window.data, instead of fake numbers. 
    - Fixed tick marks not showing.
    - Added setting for main font color.
    - Changing font color now changes font across entire app.  
    - Fixed bug where IP checker wasn't checking all 4 parts of the address. 
    - Fixed bug where IP checked crashed if given a char instead of an int. 
    - Fixed issue where gui wasn't running on Windows after all the big changes. 
    - 

- Next:
    - Finish implementing windows client to read and store data.
        - At least get a sample of /api/rootnode so we can begin loading it as a json and start trying to parse it. 
    - Change name util/utilzn/utilization to load throughout the project.
    - Add a logger to log errors and progress. Then add a button in settings where the user can print/view the log.

- Bugs: